<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Iinfinity Nature Hotel - Expenses Dashboard</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<!-- XLSX for Excel export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');
*{box-sizing:border-box;font-family:'Poppins',sans-serif}

body{
  margin:0;
  background:linear-gradient(135deg,#4facfe 0%,#00f2fe 100%);
  min-height:100vh;
  display:flex;
  flex-direction:column;
  align-items:center;
  color:#222;
}

.hero{
  position:relative;
  text-align:center;
  color:white;
  width:100%;
  padding:80px 20px;
  background:url('https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1350&q=80') center/cover no-repeat;
  background-attachment:fixed;
}
.hero::after{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.4);}
.hero h1{position:relative;font-size:2.8em;font-weight:700;z-index:1;margin:0;text-shadow:2px 2px 6px rgba(0,0,0,0.4);}

.container{
  background:white;
  border-radius:20px;
  padding:30px;
  width:98%;
  max-width:1900px;
  margin:-50px auto 40px;
  box-shadow:0 10px 30px rgba(0,0,0,0.2);
  overflow:auto;
  min-height:600px;
  display:none;
}

/* Excel look */
table{
  width:100%;
  border-collapse:collapse;
  font-size:0.95em;
  white-space:nowrap;
}
th,td{
  border:1px solid #ccc;
  padding:10px 14px;
  text-align:center;
  vertical-align:middle;
}
th{
  background:#0077b6;
  color:#fff;
  position:sticky;
  top:0;
  z-index:2;
  font-weight:600;
}
tr:nth-child(even){background:#f4f8ff;}
tr:hover{background:#e8f4ff;}
td input,td select{
  width:100%;
  border:none;
  background:transparent;
  text-align:right;
  font-size:0.95em;
  padding:4px;
}
td input:focus,td select:focus{outline:2px solid #00aaff;background:#e6f9ff;}

th:nth-child(1){min-width:120px;}
th:nth-child(2){min-width:180px;}
th:nth-child(3){min-width:150px;}
th:nth-child(4){min-width:130px;}
th:nth-child(5){min-width:140px;}
th:nth-child(6){min-width:100px;}
th:nth-child(7){min-width:120px;}
th:nth-child(8){min-width:130px;}
th:nth-child(9){min-width:130px;}
th:nth-child(10){min-width:130px;}
th:nth-child(11){min-width:130px;}
th:nth-child(12){min-width:130px;}
th:nth-child(13){min-width:130px;background:#005f8f;}
th:nth-child(14){min-width:130px;background:#005f8f;}
th:nth-child(15){min-width:130px;background:#005f8f;}
th:nth-child(16){min-width:150px;background:#005f8f;}
th:nth-child(17){min-width:160px;}

.btn{
  padding:10px 18px;
  border:none;
  border-radius:8px;
  background:linear-gradient(135deg,#0077b6,#00b4d8);
  color:white;
  font-size:0.95em;
  cursor:pointer;
  transition:0.3s;
  margin:6px 3px;
}
.btn:hover{background:linear-gradient(135deg,#00b4d8,#0077b6);transform:translateY(-2px);}
footer{color:white;text-align:center;padding:10px;opacity:0.9;}

#loginOverlay{
  position:fixed;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,0.7);
  display:flex;justify-content:center;align-items:center;
  z-index:999;
}
#loginBox{
  background:white;padding:40px 30px;border-radius:15px;
  text-align:center;box-shadow:0 8px 25px rgba(0,0,0,0.3);
  width:320px;
}
#loginBox input{
  width:100%;padding:10px;border-radius:8px;
  border:1px solid #ccc;margin:10px 0;font-size:1em;
}
#loginError{color:red;font-size:0.9em;margin-top:8px;display:none;}
</style>
</head>
<body>

<div id="loginOverlay">
  <div id="loginBox">
    <h2>Admin Login</h2>
    <input type="password" id="adminPassword" placeholder="Enter password">
    <button class="btn" onclick="checkLogin()">Login</button>
    <div id="loginError">Incorrect password. Try again.</div>
  </div>
</div>

<div class="hero"><h1>Iinfinity Nature Hotel - Expenses Dashboard</h1></div>

<div class="container" id="dashboardContainer">
<h2>Daily Expenses Records</h2>

<div style="text-align:center;margin-bottom:10px;">
  <label>From: <input type="date" id="filterFrom"></label>
  <label>To: <input type="date" id="filterTo"></label>
  <button class="btn" id="applyFilter">Filter</button>
  <button class="btn" id="downloadExcel">üìä Export</button>
  <button class="btn" id="resetHistory">üóëÔ∏è Reset</button>
  <a href="index.html" class="btn">üè† Back</a>
</div>

<table id="expensesTable">
<thead>
<tr>
<th>Date</th><th>Customer</th><th>Phone</th><th>Villa</th><th>Source</th>
<th>People</th><th>Advance</th><th>Banu Akka</th><th>Hotel2</th><th>Adi Hotel</th>
<th>Grocery</th><th>Commission</th><th>OtherExp</th>
<th>Rent</th><th>Days</th><th>BookedRate</th><th>Status</th><th>Actions</th>
</tr>
</thead>
<tbody></tbody>
</table>

<p id="loadingText" style="text-align:center;color:gray;">Loading expenses...</p>
</div>

<footer>¬© 2025 Iinfinity Nature Hotel - Kodaikanal</footer>

<script>
const ADMIN_PASSWORD="nature@admin";
function checkLogin(){
  const entered=document.getElementById("adminPassword").value;
  if(entered===ADMIN_PASSWORD){
    document.getElementById("loginOverlay").style.display="none";
    document.getElementById("dashboardContainer").style.display="block";
    loadExpenses();
  }else document.getElementById("loginError").style.display="block";
}

const firebaseConfig={
  apiKey:"AIzaSyCKbpE6RtuvgLttHvHdbVxZgtFefGyPPys",
  authDomain:"iinfinity-expenses.firebaseapp.com",
  databaseURL:"https://iinfinity-expenses-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId:"iinfinity-expenses",
  storageBucket:"iinfinity-expenses.appspot.com",
  messagingSenderId:"552799178905",
  appId:"1:552799178905:web:c7480d32d867c75c36e808",
};

firebase.initializeApp(firebaseConfig);
const db=firebase.database();
const tableBody=document.querySelector("#expensesTable tbody");

function loadExpenses(){
  tableBody.innerHTML="";
  const fromDate=document.getElementById("filterFrom").value;
  const toDate=document.getElementById("filterTo").value;
  db.ref("daily_expenses").once("value",snapshot=>{
    const data=snapshot.val();
    if(!data){document.getElementById("loadingText").textContent="No expense records yet.";return;}
    document.getElementById("loadingText").style.display="none";

    Object.entries(data).forEach(([id,item])=>{
      if((fromDate&&item.date<fromDate)||(toDate&&item.date>toDate))return;
      const tr=document.createElement("tr");
      tr.innerHTML=`
      <td>${item.date||""}</td>
      <td>${item.customer||""}</td>
      <td>${item.phone||""}</td>
      <td>${item.villa||""}</td>
      <td>${item.source||""}</td>
      <td><input type="number" value="${item.people||0}"></td>
      <td><input type="number" value="${item.advance||0}"></td>
      <td><input type="number" value="${item.banuakka||0}"></td>
      <td><input type="number" value="${item.hotel2||0}"></td>
      <td><input type="number" value="${item.adihotel||0}"></td>
      <td><input type="number" value="${item.grocery||0}"></td>
      <td><input type="number" value="${item.commission||0}"></td>
      <td><input type="number" value="${item.otherexpenses||0}"></td>
      <td><input type="number" value="${item.rent||0}" style="font-weight:600;color:#004aad;"></td>
      <td><input type="number" value="${item.days||0}" style="font-weight:600;color:#004aad;"></td>
      <td><input type="number" value="${item.bookedRate||0}" style="font-weight:600;color:#004aad;"></td>
      <td>
        <select style="font-weight:600;color:#004aad;">
          <option value="Booked" ${item.status==="Booked"?"selected":""}>Booked</option>
          <option value="Cancelled" ${item.status==="Cancelled"?"selected":""}>Cancelled</option>
          <option value="Pending" ${item.status==="Pending"?"selected":""}>Pending</option>
        </select>
      </td>
      <td>
        <button class="btn saveBtn">üíæ</button>
        <button class="btn deleteBtn" style="background:#d9534f;">üóëÔ∏è</button>
      </td>
      `;
      tableBody.appendChild(tr);

      // ‚úÖ Save Button
      tr.querySelector(".saveBtn").addEventListener("click",()=>{
        const updated={
          people:+tr.cells[5].querySelector("input").value,
          advance:+tr.cells[6].querySelector("input").value,
          banuakka:+tr.cells[7].querySelector("input").value,
          hotel2:+tr.cells[8].querySelector("input").value,
          adihotel:+tr.cells[9].querySelector("input").value,
          grocery:+tr.cells[10].querySelector("input").value,
          commission:+tr.cells[11].querySelector("input").value,
          otherexpenses:+tr.cells[12].querySelector("input").value,
          rent:+tr.cells[13].querySelector("input").value,
          days:+tr.cells[14].querySelector("input").value,
          bookedRate:+tr.cells[15].querySelector("input").value,
          status:tr.cells[16].querySelector("select").value
        };
        db.ref(`daily_expenses/${id}`).update(updated).then(()=>alert("‚úÖ Record Updated")).catch(()=>alert("‚ùå Update Failed"));
      });

      // üóëÔ∏è Delete Button
      tr.querySelector(".deleteBtn").addEventListener("click",()=>{
        if(confirm(`‚ö†Ô∏è Delete record for ${item.customer || "this entry"} on ${item.date}?`)){
          db.ref(`daily_expenses/${id}`).remove()
            .then(()=>{
              tr.remove();
              alert("üóëÔ∏è Record deleted successfully.");
            })
            .catch(()=>alert("‚ùå Failed to delete record."));
        }
      });
    });
  });
}

document.getElementById("applyFilter").addEventListener("click",loadExpenses);

// ‚úÖ Excel Export
document.getElementById("downloadExcel").addEventListener("click",()=>{
  const fromDate=document.getElementById("filterFrom").value;
  const toDate=document.getElementById("filterTo").value;
  db.ref("daily_expenses").once("value",snapshot=>{
    const data=snapshot.val();
    if(!data){alert("No data available!");return;}
    const exportData=[];
    Object.values(data).forEach(item=>{
      if((fromDate&&item.date<fromDate)||(toDate&&item.date>toDate))return;
      exportData.push({
        Date:item.date||"",
        Customer:item.customer||"",
        Phone:item.phone||"",
        Villa:item.villa||"",
        Source:item.source||"",
        People:item.people||0,
        Advance:item.advance||0,
        "Banu Akka":item.banuakka||0,
        Hotel2:item.hotel2||0,
        "Adi Hotel":item.adihotel||0,
        Grocery:item.grocery||0,
        Commission:item.commission||0,
        OtherExp:item.otherexpenses||0,
        Rent:item.rent||0,
        Days:item.days||0,
        BookedRate:item.bookedRate||0,
        Status:item.status||""
      });
    });
    if(exportData.length===0){alert("No records found in the selected date range.");return;}
    const ws=XLSX.utils.json_to_sheet(exportData);
    const wb=XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb,ws,"Expenses");
    XLSX.writeFile(wb,"IinfinityNature_Expenses.xlsx");
  });
});

document.getElementById("resetHistory").addEventListener("click",()=>{
  if(confirm("‚ö†Ô∏è Delete all records?"))
    db.ref("daily_expenses").remove().then(()=>{tableBody.innerHTML="";alert("‚úÖ All records cleared");});
});
</script>
</body>
</html>
