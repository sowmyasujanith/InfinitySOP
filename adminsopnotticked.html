<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SOP Admin Dashboard тАУ Iinfinity Nature Hotel</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');
*{box-sizing:border-box;font-family:'Poppins',sans-serif}

body {
  margin: 0;
  background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
  color: #222;
}

/* Login Overlay */
#loginOverlay{
  position:fixed;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,0.7);
  display:flex;justify-content:center;align-items:center;
  z-index:999;
}
#loginBox{
  background:white;padding:40px 30px;border-radius:15px;
  text-align:center;box-shadow:0 8px 25px rgba(0,0,0,0.3);
  width:320px;
}
#loginBox input{
  width:100%;padding:10px;border-radius:8px;
  border:1px solid #ccc;margin:10px 0;font-size:1em;
}
#loginError{color:red;font-size:0.9em;margin-top:8px;display:none;}

/* Header */
header {
  background: #004d40;
  color: white;
  text-align: center;
  padding: 15px;
  font-size: 1.5em;
  font-weight: bold;
}

/* Container */
.container {
  max-width: 1200px;
  margin: 30px auto;
  background: white;
  border-radius: 20px;
  padding: 25px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.2);
  display:none;
}

h2 {
  text-align: center;
  color: #004d40;
}

.filter-section {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin-bottom: 20px;
}

input[type="date"] {
  padding: 6px 10px;
  border-radius: 8px;
  border: 1px solid #ccc;
}

button {
  background: linear-gradient(135deg, #0077b6, #00b4d8);
  color: white;
  border: none;
  padding: 10px 18px;
  border-radius: 8px;
  cursor: pointer;
}
button:hover {
  background: linear-gradient(135deg, #00b4d8, #0077b6);
}

.tabs {
  display: flex;
  justify-content: center;
  margin-bottom: 20px;
  flex-wrap: wrap;
  gap: 5px;
}

.tab {
  padding: 10px 20px;
  margin: 0 5px;
  border-radius: 6px;
  background: #e0f2f1;
  color: #004d40;
  cursor: pointer;
  font-weight: 600;
}
.tab.active {
  background: #004d40;
  color: white;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
}
th, td {
  border: 1px solid #ccc;
  text-align: left;
  padding: 8px;
}
th {
  background: #0077b6;
  color: white;
}
tr:nth-child(even) {
  background: #f8f8f8;
}

.export-btn {
  margin-top: 15px;
  background: #28a745;
}

footer {
  text-align: center;
  color: white;
  padding: 10px;
  margin-top: 20px;
}
</style>
</head>
<body>

<!-- Login Overlay -->
<div id="loginOverlay">
  <div id="loginBox">
    <h2>Admin Login</h2>
    <input type="password" id="adminPassword" placeholder="Enter password">
    <button onclick="checkLogin()">Login</button>
    <div id="loginError">Incorrect password. Try again.</div>
  </div>
</div>

<header>SOP Admin Dashboard тАУ Iinfinity Nature Hotel</header>

<div class="container" id="dashboardContainer">
  <h2>View Unticked SOP Records</h2>
  <div class="filter-section">
    <label>From: <input type="date" id="fromDate"></label>
    <label>To: <input type="date" id="toDate"></label>
    <button id="loadBtn">Load Records</button>
  </div>

  <div class="tabs">
    <div class="tab active" data-type="daily">Daily</div>
    <div class="tab" data-type="weekly">Weekly</div>
    <div class="tab" data-type="monthly">Monthly</div>
    <div class="tab" id="translateBtn">ЁЯМР Translate</div>
  </div>

  <table id="recordsTable">
    <thead>
      <tr>
        <th>Date</th>
        <th>Serial</th>
        <th>Task</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <button id="exportBtn" class="export-btn">Export to CSV</button>
  <button id="exportExcelBtn" class="export-btn" style="display:none;">Export to Excel</button>
</div>

<footer>
  ┬й 2025 Iinfinity Nature Hotel тАУ Kodaikanal <br>
  <a href="index.html" style="color:white;text-decoration:underline;">тЖР Back to Expenses</a>
</footer>

<script>
const ADMIN_PASSWORD = "nature@admin";
function checkLogin(){
  const entered = document.getElementById("adminPassword").value.trim();
  const error = document.getElementById("loginError");
  if (entered === ADMIN_PASSWORD){
    document.getElementById("loginOverlay").style.display = "none";
    document.getElementById("dashboardContainer").style.display = "block";
    error.style.display = "none";
  } else {
    error.style.display = "block";
  }
}

// Firebase Initialization
const firebaseConfig = {
  apiKey: "AIzaSyBS9CW3cnvD8-gN08qWtE9uF3qEDqfixmw",
  authDomain: "iinfinitysop.firebaseapp.com",
  databaseURL: "https://iinfinitysop-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "iinfinitysop",
  storageBucket: "iinfinitysop.firebasestorage.app",
  messagingSenderId: "21802379487",
  appId: "1:21802379487:web:041c79f8ae0a1f5c50616a",
  measurementId: "G-WL5TCJ100Y"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// тЬЕ FIXED: initialized properly

let DAILY_SOP = [
  {serial:"1.0", text:"роЕройрпНро▒ро╛роЯ рокрпВроЬрпИ родро╡ро▒ро╛рооро▓рпН роЪрпЖропрпНропро╡рпБроорпН."},
  {serial:"2.0", text:"рооро╛ро▓рпИ роорпБройрпНрокрпБ родрогрпНрогрпАро░рпН родрпКроЯрпНроЯро┐ роиро┐ро░рокрпНрокро╡рпБроорпН."},
  {serial:"3.0", text:"роХрпБро│роорпН роорпЛроЯрпНроЯро╛ро░рпН 2 роорогро┐ роирпЗро░роорпН роЗропроХрпНроХро┐ родрогрпНрогрпАро░рпН роиро┐ро▓рпИ роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН."},
  {serial:"4.0", text:"ро▓роЯрпНроЪрпБрооро┐ропрпИ роорпЗропрпНроЪрпНроЪро┐роХрпНроХро╛роХ роЕройрпБрокрпНрокро┐, роЕро╡ро│родрпБ рокро░рокрпНрокрпИропрпБроорпН роЪрпБродрпНродрооро╛роХ ро╡рпИроХрпНроХро╡рпБроорпН."},
  {serial:"5.0", text:"рооро╛ро▓рпИ ро▓роЯрпНроЪрпБрооро┐ропрпИ родро┐ро░рпБрокрпНрокро┐ роХрпКрогрпНроЯрпБ ро╡роирпНродрпБ рокрпЛродрпБрооро╛рой родрогрпНрогрпАро░рпН ро╡ро┤роЩрпНроХро╡рпБроорпН."},
  {serial:"6.0", text:"роХрпЛро┤ро┐ рокро░рокрпНрокрпИ роЪрпБродрпНродроорпН роЪрпЖропрпНродрпБ, роЕро╡ро░рпНроХро│рпБроХрпНроХрпБ роЙрогро╡рпБ роХрпКроЯрпБроХрпНроХро╡рпБроорпН."},
  {serial:"7.0", text:"роЕройрпИродрпНродрпБ ропрпВройро┐роЯрпНроХро│ро┐ро▓рпН роХро╛ро▓рпИропро┐ро▓рпН роЬройрпНройро▓рпНроХро│рпН родро┐ро▒роирпНродрпБ роХро╛ро▒рпНро▒рпЛроЯрпНроЯроорпН роПро▒рпНрокроЯрпБродрпНродро╡рпБроорпН."},
  {serial:"8.0", text:"роЕроЯрпБроХрпНроХрпБ роЪроорпИропро▓ро▒рпИ рокрпКро░рпБроЯрпНроХро│рпН рооро▒рпНро▒рпБроорпН рокрпЖроЯрпНроЯро┐роХро│рпИ роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН."},
  {serial:"9.0", text:"UPS роЪро╛ро░рпНроЬрпН рооро▒рпНро▒рпБроорпН родрогрпНрогрпАро░рпН роиро┐ро▓рпИропрпИ роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН."},
  {serial:"10.0", text:"роЬрпЖройро░рпЗроЯрпНроЯро░ро┐ро▓рпН роОрокрпНрокрпЛродрпБроорпН рокрпЛродрпБрооро╛рой рокрпЖроЯрпНро░рпЛро▓рпН роЗро░рпБроХрпНроХрпБрооро╛ро▒рпБ ро╡рпИродрпНродро┐ро░рпБроХрпНроХро╡рпБроорпН."},
  {serial:"11.0", text:"роороЮрпНроЪро│рпН роорпЖродрпНродрпИ, родро▓рпИропрогрпИ роорпВроЯрпБроХро│рпН, рокроЮрпНроЪрпБ рооро▒рпНро▒рпБроорпН родрпБрогро┐роХро│рпИ роХро┤рпБро╡ро╡рпБроорпН."},
  {serial:"12.0", text:"роПродрпЗройрпБроорпН роЪрпЗродроороЯрпИроирпНрод рокрпКро░рпБроЯрпНроХро│рпИроЪрпН роЪро░ро┐ роЪрпЖропрпНродрпБ рокрпБроХро╛ро░ро│ро┐роХрпНроХро╡рпБроорпН."},
  {serial:"13.0", text:"роХрпБро┤рокрпНрокрооро┐ро▓рпНро▓ро╛рооро▓рпН роЙрогро╡рпБ роХро┤ро┐ро╡рпБроХро│рпИ роиро╛роХро░ро╛роЬройрпН рокроХрпБродро┐ропро┐ро▓рпБро│рпНро│ роХроорпНрокрпЛро╕рпНроЯрпН роЪро┐родрпНродро┐ро░родрпНродро┐ро▓рпН роЗроЯро╡рпБроорпН."},
  {serial:"14.0", text:"ро╡рпЖро│ро┐рокрпНрокрпБро▒ роирокро░рпНроХро│рпИ роЕройрпБроородро┐роХрпНроХро╛родрпАро░рпНроХро│рпН; ропро╛ро░ро╛ро╡родрпБ ро╡роирпНродро╛ро▓рпН родроХро╡ро▓рпН родро░ро╡рпБроорпН."},
  {serial:"15.0", text:"роХро┤ро┐рокрпНрокро▒рпИроХро│рпИ родро┐ройроЪро░ро┐ роЪрпБродрпНродроорпН роЪрпЖропрпНропро╡рпБроорпН рооро▒рпНро▒рпБроорпН роЙрооро┐ро┤рпНро╡рпБроХро│рпИ роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН."},
  {serial:"16.0", text:"рооро╛ро▓рпНройроорпН рокрпЖроЯрпНроЯро┐роХро│рпИ роХро╛ро▓ро┐ роЪрпЖропрпНропро╡рпБроорпН рооро▒рпНро▒рпБроорпН роЪрпБро▒рпНро▒рпБрокрпНрокрпБро▒родрпНродрпИ роЪрпБродрпНродрооро╛роХ ро╡рпИродрпНродро┐ро░рпБроЩрпНроХро│рпН."},
  {serial:"17.0", text:"роХро▓роЩрпНроХро╛рооро▓рпН ро╡рпИроХрпНроХ, роиро╛роХро░ро╛роЬройрпН рокроХрпБродро┐ропрпИ роЕро░рпБроХро┐ро▓рпЗропрпЗ роЙроЯрпИроХро│рпН роЙро▓ро░рпНродрпНродро╡рпБроорпН."},
  {serial:"18.0", text:"роХрогрпНрогро╛роЯро┐, роХро┐ро│ро╛ро╕рпН, роЬроХрпНроХрпБроХро│рпН, роХрпЗроЯрпНроЯро┐ро▓рпН рокрпЛройрпНро▒ро╡ро▒рпНро▒рпИ роЪрпБродрпНродроорпН роЪрпЖропрпНродрпБ ро╡ро┐ро░рпБроирпНродро┐ройро░рпНроХро│рпБроХрпНроХрпБродрпН родропро╛ро░рпН ро╡рпИроХрпНроХро╡рпБроорпН."}
];

let WEEKLY_SOP = [
  {serial:"19.0", text:"ро╡рпАроЯрпНроЯрпБ рокро░рокрпНрокрпИ ро╡ро╛ро░родрпНродро┐ро▓рпН роорпВройрпНро▒рпБ роорпБро▒рпИ роорпЗро▓ро┐ро░рпБроирпНродрпБ роХрпАро┤рпН ро╡ро░рпИ роЪрпБродрпНродроорпН роЪрпЖропрпНропро╡рпБроорпН."},
  {serial:"20.0", text:"рооро░роорпН, роЪрпЖроЯро┐роХро│рпН рооро▒рпНро▒рпБроорпН роХро╛ропрпНроХро▒ро┐роХро│рпИ рокро░ро╛рооро░ро┐роХрпНроХро╡рпБроорпН тАУ роХрпАро░рпИроХро│рпН роЕроХро▒рпНро▒ро╡рпБроорпН, роХроорпНрокрпЛро╕рпНроЯрпН рокропройрпНрокроЯрпБродрпНродро╡рпБроорпН."},
  {serial:"21.0", text:"роорпЗро▓рпН роХрпВро░рпИ ро╡ро╛ро░родрпНродро┐ро▓рпН роорпВройрпНро▒рпБ роорпБро▒рпИ роЪрпБродрпНродроорпН роЪрпЖропрпНропро╡рпБроорпН; роХрпЛрогроЩрпНроХро│рпН родрпВроЪро┐ роЪрпЖропрпНропро╡рпБроорпН рооро▒рпНро▒рпБроорпН родро░рпИ родрпБроЯрпИроХрпНроХро╡рпБроорпН."},
  {serial:"22.0", text:"роЕройрпИродрпНродрпБ роХродро╡рпБ роорпЗроЯрпНро░ро╛ро╕рпН роХро┤рпБро╡ро╡рпБроорпН."},
  {serial:"23.0", text:"роХродро╡рпБроХро│рпН, роЬройрпНройро▓рпНроХро│рпН, роХрогрпНрогро╛роЯро┐, ро╡ро┐роЪро┐ро▒ро┐роХро│рпН, роорпЗроЪрпИроХро│рпН рооро▒рпНро▒рпБроорпН ропрпВройро┐роЯрпН роЙро│рпНро│роорпИрокрпНрокрпБроХро│рпИ роЖро┤рооро╛роХ роЪрпБродрпНродроорпН роЪрпЖропрпНропро╡рпБроорпН."},
  {serial:"25.0", text:"ропрпВройро┐роЯрпНроХро│рпИ рокро░ро╛рооро░ро┐рокрпНрокрпБ родрпЗро╡рпИ роЕро▓рпНро▓родрпБ рокро┤рпБродрпБ рокро╛ро░рпНро╡рпИ роЪрпЖропрпНропро╡рпБроорпН."},
  {serial:"26.0", text:"роХрпЗроорпНрокрпНроГрокропро░рпН роХрпНроХро╛рой ро╡ро▒рогрпНроЯ рооро░роЩрпНроХро│рпН родропро╛ро░ро╛роХ роЗро░рпБроХрпНроХрпБрооро╛ро▒рпБ ро╡рпИроХрпНроХро╡рпБроорпН."},
  {serial:"27.0", text:"рокро╛ро░рпНрокро┐роХро┐ропрпВ роХрпНроХро╛рой роЪро╛ро░рпНроХрпЛро▓рпН рокро░ро╛рооро░ро┐роХрпНроХро╡рпБроорпН."},
  {serial:"28.0", text:"роХрогрпНрогро╛роЯро┐, роЬроХрпНроХрпБроХро│рпН, роХро┐ро│ро╛ро╕рпН роЕройрпИродрпНродрпИропрпБроорпН роЙро▓ро░рпНроирпНрод роЪрпБродрпНродрокрпН рокрпНро░ро╖рпН рооро▒рпНро▒рпБроорпН роЪрпЛрокрпНрокро╛ро▓рпН роЪрпБродрпНродроорпН роЪрпЖропрпНропро╡рпБроорпН."},
  {serial:"29.0", text:"роЕройрпИродрпНродрпБ роЪрпБродрпНродрокрпНрокроЯрпБродрпНродрпБроорпН родрпБрогро┐роХро│рпИ роорпЖро╖ро┐ройро┐ро▓рпН роХро┤рпБро╡ро┐, рокроЯрпНроЯро┐ропро▓рпИ рокро░ро╛рооро░ро┐роХрпНроХро╡рпБроорпН."},
  {serial:"30.0", text:"роЕройрпИродрпНродрпБ ропрпВройро┐роЯрпНроХро│ро┐ройрпН рокроЯрпБроХрпНроХрпИ рооро▒рпНро▒рпБроорпН роЪрпБро╡ро░ро┐ройрпН роиро┐ро▓рпИропрпИ роХро╛роЯрпНроЯрпБроорпН родрпЖро│ро┐ро╡ро╛рой ро╡рпАроЯро┐ропрпЛроХрпНроХро│рпИ роЕройрпБрокрпНрокро╡рпБроорпН."},
  {serial:"31.0", text:"роЙроЯрпИ роЙро▓ро░рпНродрпНродрпБроорпН рокрпЛродрпБ роирпЗро░роЯро┐ропро╛роХ роЪрпВро░ро┐роп роТро│ро┐ропро┐ро▓рпН ро╡рпИроХрпНроХро╡рпБроорпН; роорпЖро╖ро┐ройро┐ро▓рпН родрогрпНрогрпАро░рпН роЗро░рпБроХрпНроХрпБроорпН рокрпЛродрпБ ро╡ро┐роЯро╛родрпАро░рпНроХро│рпН."},
  {serial:"32.0", text:"роорпЖродрпНродро┐ро░ро╕рпН роорпВроЯрпБроХро│рпИ роорпБро┤рпБроорпИропро╛роХ роЙро▓ро░рпНроирпНрод рокро┐ро▒роХрпБ роЪрпЗрооро┐роХрпНроХро╡рпБроорпН."},
  {serial:"33.0", text:"роЙро│рпНро│роЯроХрпНроХ роородроЩрпНроХро│рпИ роХрпИ роХро┤рпБро╡ро╡рпБроорпН."},
  {serial:"34.0", text:"роЙро│рпНро│роорпИроирпНрод родро╛ро╡ро░роЩрпНроХро│рпБроХрпНроХрпБ ро╡ро╛ро░родрпНродро┐ро▒рпНроХрпБ роЗро░рогрпНроЯрпБ роорпБро▒рпИ родрогрпНрогрпАро░рпН ро╡ро┤роЩрпНроХро╡рпБроорпН."},
  {serial:"35.0", text:"роЕройрпИродрпНродрпБ роЕро▓роЩрпНроХро╛ро░ рооро▒рпНро▒рпБроорпН роорпЖро┤рпБроХрпБро╡ро░рпНродрпНродро┐ роЯро┐ройрпНройро░рпН рокрпКро░рпБроЯрпНроХро│рпИ роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН."},
  {serial:"36.0", text:"роПродрпЗройрпБроорпН рокро┤рпБродрпБ роЕро▓рпНро▓родрпБ рокро░ро╛рооро░ро┐рокрпНрокрпБ родрпЗро╡рпИ роЗро░рпБрокрпНрокро┐ройрпН роЙроЯройроЯро┐ропро╛роХ рокрпБроХро╛ро░рпН роЪрпЖропрпНропро╡рпБроорпН."},
  {serial:"37.0", text:"роХрпЛро┤ро┐ (ро▓роЯрпНроЪрпБрооро┐)роХрпНроХрпБ ро╡ро╛ро░родрпНродро┐ро▒рпНроХрпБ роЗро░рогрпНроЯрпБ роорпБро▒рпИ роирпАро░ро╛роЯ роЪрпЖропрпНропро╡рпБроорпН."},
  {serial:"38.0", text:"роЪроорпИропро▓ро▒рпИропрпИ роЖро┤рооро╛роХ роЪрпБродрпНродроорпН роЪрпЖропрпНропро╡рпБроорпН, роТро╡рпНро╡рпКро░рпБ 10 роиро╛роЯрпНроХро│рпБроорпН."},
  {serial:"39.0", text:"рокро┐ро░родро┐ рокро╛роХроЩрпНроХро│рпН рооро▒рпНро▒рпБроорпН роХро░рпБро╡ро┐роХро│рпН рокроЯрпНроЯро┐ропро▓рпИ рокро░ро╛рооро░ро┐роХрпНроХро╡рпБроорпН; роХроЯройро┐ро▓рпН ро╡ро┐роЯро╛родрпАро░рпНроХро│рпН."}
];

let MONTHLY_SOP = [
  {serial:"40.0", text:"роЪрпЛрокро╛ роХрпБро╖ройрпН роорпВроЯро┐роХро│рпИ рооро╛родродрпНродро┐ро▓рпН роТро░рпБроорпБро▒рпИ роХро┤рпБро╡ро┐ роЙро▓ро░рпНроирпНрод рокро┐ро▒роХрпБ рооро╛ро▒рпНро▒ро╡рпБроорпН."},
  {serial:"41.0", text:"роЕройрпИродрпНродрпБ рокроЯрпБроХрпНроХрпИ родрпБрогро┐роХро│рпН, роЪроорпИропро▓рпН рокро╛родрпНродро┐ро░роЩрпНроХро│рпН, родро▓рпИропрогрпИ, рокрпЛро░рпНро╡рпИроХро│рпН, ро╡ро┐ро│рпИропро╛роЯрпНроЯрпБрокрпН рокрпКро░рпБроЯрпНроХро│рпИ роОрогрпНрогро╡рпБроорпН."},
  {serial:"42.0", text:"роЕройрпИродрпНродрпБ рокрпКро░рпБроЯрпНроХро│рпИ роЪро░ро┐рокро╛ро░рпНродрпНродрпБ рокродро┐ро╡рпБ рокрпБродрпНродроХродрпНродро┐ро▓рпН роЗроЯро╡рпБроорпН."},
  {serial:"43.0", text:"роЪрпЗродроороЯрпИроирпНрод роЕро▓рпНро▓родрпБ рооро╛роЪрпБрокроЯрпНроЯ роорпЖродрпНродро┐ро░ро╕рпН роорпВроЯро┐роХро│рпИ рокрпБроХрпИрокрпНрокроЯроорпН роОроЯрпБродрпНродрпБ роЕроХро▒рпНро▒ро╡рпБроорпН."},
  {serial:"44.0", text:"роЯро┐ро╡ро┐ рокро╛роХрпНроХрпЗроЬрпИ ро░рпАроЪро╛ро░рпНроЬрпН роЪрпЖропрпНропро╡рпБроорпН."}
];

const originalSOP = {
  daily: JSON.parse(JSON.stringify(DAILY_SOP)),
  weekly: JSON.parse(JSON.stringify(WEEKLY_SOP)),
  monthly: JSON.parse(JSON.stringify(MONTHLY_SOP))
};

// English translation dataset (kept same)
const ENGLISH_SOP = {
  daily: [
    {serial:"1.0",text:"Perform daily pooja without fail."},
    {serial:"2.0",text:"Fill the water tank before evening."},
    {serial:"3.0",text:"Run the pond motor for 2 hours daily and check water level."},
    {serial:"4.0",text:"Send Lakshmi (cow) to graze and keep her area clean."},
    {serial:"5.0",text:"Bring Lakshmi back in the evening and provide enough water."},
    {serial:"6.0",text:"Clean the hen area and feed them."},
    {serial:"7.0",text:"Open windows in all units in the morning for ventilation."},
    {serial:"8.0",text:"Check kitchen items and boxes."},
    {serial:"9.0",text:"Check UPS charge and water level."},
    {serial:"10.0",text:"Keep sufficient petrol in generator always."},
    {serial:"11.0",text:"Wash bed covers, pillow covers, blankets, and towels."},
    {serial:"12.0",text:"Report and fix any damaged mattress covers or items."},
    {serial:"13.0",text:"Dispose food waste (not plastic) in compost pit near Nagarajan's area."},
    {serial:"14.0",text:"Do not allow outsiders into premises; report if anyone comes."},
    {serial:"15.0",text:"Clean bathrooms daily and check for leaks."},
    {serial:"16.0",text:"Empty garbage bins and keep surroundings clean."},
    {serial:"17.0",text:"Dry clothes near NagarajanтАЩs area, not visible from property."},
    {serial:"18.0",text:"Clean bottles, glasses, jugs, kettles and keep ready for guests."}
  ],
  weekly: [
    {serial:"19.0",text:"Clean premises from top to bottom thrice a week."},
    {serial:"20.0",text:"Maintain trees, plants, and vegetables тАУ remove weeds, apply compost."},
    {serial:"21.0",text:"Clean top shed thrice weekly; dust furniture and mop floor."},
    {serial:"22.0",text:"Wash all door mats."},
    {serial:"23.0",text:"Deep clean doors, windows, glass, fans, tables, and unit interiors."},
    {serial:"25.0",text:"Inspect units for repairs or maintenance needs."},
    {serial:"26.0",text:"Keep dry firewood ready for campfire."},
    {serial:"27.0",text:"Maintain charcoal for barbecue."},
    {serial:"28.0",text:"Clean bottles, jugs, glasses well with brush and soap."},
    {serial:"29.0",text:"Wash all cleaning cloths in washing machine and maintain stock list."},
    {serial:"30.0",text:"Send clear videos of each unit showing condition of beds and walls."},
    {serial:"31.0",text:"Wash and dry clothes in sunlight; do not leave wet in machine overnight."},
    {serial:"32.0",text:"Store mattress covers only after fully dried."},
    {serial:"33.0",text:"Hand wash all indoor mats."},
    {serial:"34.0",text:"Water indoor plants twice a week."},
    {serial:"35.0",text:"Check all decorative and candlelight dinner items."},
    {serial:"36.0",text:"Report any repair or maintenance requirements immediately."},
    {serial:"37.0",text:"Give cow (Lakshmi) water bath twice a week."},
    {serial:"38.0",text:"Deep clean kitchen once every 10 days."},
    {serial:"39.0",text:"Maintain list of spare parts and tools; do not lend them out."}
  ],
  monthly: [
    {serial:"40.0",text:"Wash sofa cushion covers monthly and replace after drying."},
    {serial:"41.0",text:"Count all bed sheets, kitchen dishes, pillows, blankets, games, etc."},
    {serial:"42.0",text:"Take stock of all items and record in register."},
    {serial:"43.0",text:"Remove damaged or stained mattress covers after photographing."},
    {serial:"44.0",text:"Recharge TV package."}
  ]
};

const loadBtn = document.getElementById("loadBtn");
const fromDate = document.getElementById("fromDate");
const toDate = document.getElementById("toDate");
const tableBody = document.querySelector("#recordsTable tbody");
const tabs = document.querySelectorAll(".tab");
let currentType = "daily";
let isTranslated = false;

// Load SOP data
loadBtn.addEventListener("click", async () => {
  tableBody.innerHTML = "<tr><td colspan='4'>Loading...</td></tr>";
  if (!fromDate.value || !toDate.value) {
    alert("Please select date range.");
    return;
  }
  const start = new Date(fromDate.value);
  const end = new Date(toDate.value);

  const [dailySnap, weeklySnap, monthlySnap] = await Promise.all([
    db.ref("daily_sop").get(),
    db.ref("weekly_sop").get(),
    db.ref("monthly_sop").get()
  ]);

  const allData = {
    daily_sop: dailySnap.val() || {},
    weekly_sop: weeklySnap.val() || {},
    monthly_sop: monthlySnap.val() || {}
  };

  const combinedRecords = [];
  for (const [type, data] of Object.entries(allData)) {
    Object.entries(data).forEach(([date, record]) => {
      const d = new Date(date);
      if (d >= start && d <= end) {
        combinedRecords.push({ date, type, checked_items: record.checked_items || [] });
      }
    });
  }

  renderTable(combinedRecords);
});

// Render table
function renderTable(records) {
  tableBody.innerHTML = "";
  const master = currentType === "daily" ? DAILY_SOP :
                  currentType === "weekly" ? WEEKLY_SOP : MONTHLY_SOP;

  records.forEach(record => {
    if (record.type.replace("_sop","") === currentType) {
      const checkedSerials = (record.checked_items || []).map(i => i.serial);
      const unticked = master.filter(item => !checkedSerials.includes(item.serial));
      unticked.forEach(item => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${record.date}</td>
          <td>${item.serial || ""}</td>
          <td>${item.text}</td>
          <td>тЭМ Pending</td>
        `;
        tableBody.appendChild(tr);
      });
    }
  });

  if (!tableBody.innerHTML.trim()) {
    tableBody.innerHTML = "<tr><td colspan='4'>No unticked records found.</td></tr>";
  }
}

// Tab switching
tabs.forEach(tab => {
  tab.addEventListener("click", () => {
    if (tab.id === "translateBtn") return;
    tabs.forEach(t => t.classList.remove("active"));
    tab.classList.add("active");
    currentType = tab.dataset.type;
    loadBtn.click();
  });
});

// Translate toggle
document.getElementById("translateBtn").addEventListener("click", () => {
  if (!isTranslated) {
    DAILY_SOP = ENGLISH_SOP.daily;
    WEEKLY_SOP = ENGLISH_SOP.weekly;
    MONTHLY_SOP = ENGLISH_SOP.monthly;
    document.getElementById("translateBtn").textContent = "ЁЯФЩ Back to Tamil";
    document.getElementById("exportExcelBtn").style.display = "inline-block";
    isTranslated = true;
  } else {
    DAILY_SOP = originalSOP.daily;
    WEEKLY_SOP = originalSOP.weekly;
    MONTHLY_SOP = originalSOP.monthly;
    document.getElementById("translateBtn").textContent = "ЁЯМР Translate";
    document.getElementById("exportExcelBtn").style.display = "none";
    isTranslated = false;
  }
  loadBtn.click();
});

// Export CSV
document.getElementById("exportBtn").addEventListener("click", () => {
  const rows = [["Date", "Serial", "Task", "Status"]];
  document.querySelectorAll("#recordsTable tbody tr").forEach(tr => {
    const cols = Array.from(tr.children).map(td => td.textContent.trim());
    rows.push(cols);
  });
  let csv = rows.map(r => r.join(",")).join("\n");
  const blob = new Blob([csv], { type: "text/csv" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "Unticked_SOP_Report.csv";
  a.click();
});

// Export Excel
document.getElementById("exportExcelBtn").addEventListener("click", () => {
  const rows = [["Date","Serial","Task","Status"]];
  document.querySelectorAll("#recordsTable tbody tr").forEach(tr=>{
    rows.push(Array.from(tr.children).map(td=>td.textContent.trim()));
  });
  let csv = rows.map(r=>r.join("\t")).join("\n");
  const blob = new Blob([csv],{type:"application/vnd.ms-excel"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="Unticked_SOP_Report.xls";
  a.click();
});
</script>
</body>
</html>
