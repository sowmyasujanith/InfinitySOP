<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SOP Admin Dashboard ‚Äì Iinfinity Nature Hotel</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');
*{box-sizing:border-box;font-family:'Poppins',sans-serif}

body {
  margin: 0;
  background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
  color: #222;
}

/* Login Overlay */
#loginOverlay{
  position:fixed;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,0.7);
  display:flex;justify-content:center;align-items:center;
  z-index:999;
}
#loginBox{
  background:white;padding:40px 30px;border-radius:15px;
  text-align:center;box-shadow:0 8px 25px rgba(0,0,0,0.3);
  width:320px;
}
#loginBox input{
  width:100%;padding:10px;border-radius:8px;
  border:1px solid #ccc;margin:10px 0;font-size:1em;
}
#loginError{color:red;font-size:0.9em;margin-top:8px;display:none;}

/* Header */
header {
  background: #004d40;
  color: white;
  text-align: center;
  padding: 15px;
  font-size: 1.5em;
  font-weight: bold;
}

/* Container */
.container {
  max-width: 1200px;
  margin: 30px auto;
  background: white;
  border-radius: 20px;
  padding: 25px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.2);
  display:none;
}

h2 {
  text-align: center;
  color: #004d40;
}

.filter-section {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin-bottom: 20px;
}

input[type="date"] {
  padding: 6px 10px;
  border-radius: 8px;
  border: 1px solid #ccc;
}

button {
  background: linear-gradient(135deg, #0077b6, #00b4d8);
  color: white;
  border: none;
  padding: 10px 18px;
  border-radius: 8px;
  cursor: pointer;
}
button:hover {
  background: linear-gradient(135deg, #00b4d8, #0077b6);
}

.tabs {
  display: flex;
  justify-content: center;
  margin-bottom: 20px;
  flex-wrap: wrap;
  gap: 5px;
}

.tab {
  padding: 10px 20px;
  margin: 0 5px;
  border-radius: 6px;
  background: #e0f2f1;
  color: #004d40;
  cursor: pointer;
  font-weight: 600;
}
.tab.active {
  background: #004d40;
  color: white;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
}
th, td {
  border: 1px solid #ccc;
  text-align: left;
  padding: 8px;
}
th {
  background: #0077b6;
  color: white;
}
tr:nth-child(even) {
  background: #f8f8f8;
}

.export-btn {
  margin-top: 15px;
  background: #28a745;
}

footer {
  text-align: center;
  color: white;
  padding: 10px;
  margin-top: 20px;
}
</style>
</head>
<body>

<!-- Login Overlay -->
<div id="loginOverlay">
  <div id="loginBox">
    <h2>Admin Login</h2>
    <input type="password" id="adminPassword" placeholder="Enter password">
    <button onclick="checkLogin()">Login</button>
    <div id="loginError">Incorrect password. Try again.</div>
  </div>
</div>

<header>SOP Admin Dashboard ‚Äì Iinfinity Nature Hotel</header>

<div class="container" id="dashboardContainer">
  <h2>View Unticked SOP Records</h2>
  <div class="filter-section">
    <label>From: <input type="date" id="fromDate"></label>
    <label>To: <input type="date" id="toDate"></label>
    <button id="loadBtn">Load Records</button>
  </div>

  <div class="tabs">
    <div class="tab active" data-type="daily">Daily</div>
    <div class="tab" data-type="weekly">Weekly</div>
    <div class="tab" data-type="monthly">Monthly</div>
    <div class="tab" id="translateBtn">üåê Translate</div>
  </div>

  <table id="recordsTable">
    <thead>
      <tr>
        <th>Date</th>
        <th>Serial</th>
        <th>Task</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <button id="exportBtn" class="export-btn">Export to CSV</button>
  <button id="exportExcelBtn" class="export-btn" style="display:none;">Export to Excel</button>
</div>

<footer>
  ¬© 2025 Iinfinity Nature Hotel ‚Äì Kodaikanal <br>
  <a href="index.html" style="color:white;text-decoration:underline;">‚Üê Back to Expenses</a>
</footer>

<script>
const ADMIN_PASSWORD = "nature@admin";
function checkLogin(){
  const entered = document.getElementById("adminPassword").value.trim();
  const error = document.getElementById("loginError");
  if (entered === ADMIN_PASSWORD){
    document.getElementById("loginOverlay").style.display = "none";
    document.getElementById("dashboardContainer").style.display = "block";
    error.style.display = "none";
  } else {
    error.style.display = "block";
  }
}

// Firebase Initialization
const firebaseConfig = {
  apiKey: "AIzaSyBS9CW3cnvD8-gN08qWtE9uF3qEDqfixmw",
  authDomain: "iinfinitysop.firebaseapp.com",
  databaseURL: "https://iinfinitysop-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "iinfinitysop",
  storageBucket: "iinfinitysop.firebasestorage.app",
  messagingSenderId: "21802379487",
  appId: "1:21802379487:web:041c79f8ae0a1f5c50616a",
  measurementId: "G-WL5TCJ100Y"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ‚úÖ FIXED: initialized properly

let DAILY_SOP = [
  {serial:"1.0", text:"‡ÆÖ‡Æ©‡Øç‡Æ±‡Ææ‡Æü ‡Æ™‡ØÇ‡Æú‡Øà ‡Æ§‡Æµ‡Æ±‡Ææ‡ÆÆ‡Æ≤‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æµ‡ØÅ‡ÆÆ‡Øç."},
  {serial:"2.0", text:"‡ÆÆ‡Ææ‡Æ≤‡Øà ‡ÆÆ‡ØÅ‡Æ©‡Øç‡Æ™‡ØÅ ‡Æ§‡Æ£‡Øç‡Æ£‡ØÄ‡Æ∞‡Øç ‡Æ§‡Øä‡Æü‡Øç‡Æü‡Æø ‡Æ®‡Æø‡Æ∞‡Æ™‡Øç‡Æ™‡Æµ‡ØÅ‡ÆÆ‡Øç."},
  {serial:"3.0", text:"‡Æï‡ØÅ‡Æ≥‡ÆÆ‡Øç ‡ÆÆ‡Øã‡Æü‡Øç‡Æü‡Ææ‡Æ∞‡Øç 2 ‡ÆÆ‡Æ£‡Æø ‡Æ®‡Øá‡Æ∞‡ÆÆ‡Øç ‡Æá‡ÆØ‡Æï‡Øç‡Æï‡Æø ‡Æ§‡Æ£‡Øç‡Æ£‡ØÄ‡Æ∞‡Øç ‡Æ®‡Æø‡Æ≤‡Øà ‡Æö‡Æ∞‡Æø‡Æ™‡Ææ‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç."},
  {serial:"4.0", text:"‡Æ≤‡Æü‡Øç‡Æö‡ØÅ‡ÆÆ‡Æø‡ÆØ‡Øà ‡ÆÆ‡Øá‡ÆØ‡Øç‡Æö‡Øç‡Æö‡Æø‡Æï‡Øç‡Æï‡Ææ‡Æï ‡ÆÖ‡Æ©‡ØÅ‡Æ™‡Øç‡Æ™‡Æø, ‡ÆÖ‡Æµ‡Æ≥‡Æ§‡ØÅ ‡Æ™‡Æ∞‡Æ™‡Øç‡Æ™‡Øà‡ÆØ‡ØÅ‡ÆÆ‡Øç ‡Æö‡ØÅ‡Æ§‡Øç‡Æ§‡ÆÆ‡Ææ‡Æï ‡Æµ‡Øà‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç."},
  {serial:"5.0", text:"‡ÆÆ‡Ææ‡Æ≤‡Øà ‡Æ≤‡Æü‡Øç‡Æö‡ØÅ‡ÆÆ‡Æø‡ÆØ‡Øà ‡Æ§‡Æø‡Æ∞‡ØÅ‡Æ™‡Øç‡Æ™‡Æø ‡Æï‡Øä‡Æ£‡Øç‡Æü‡ØÅ ‡Æµ‡Æ®‡Øç‡Æ§‡ØÅ ‡Æ™‡Øã‡Æ§‡ØÅ‡ÆÆ‡Ææ‡Æ© ‡Æ§‡Æ£‡Øç‡Æ£‡ØÄ‡Æ∞‡Øç ‡Æµ‡Æ¥‡Æô‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç."},
  {serial:"6.0", text:"‡Æï‡Øã‡Æ¥‡Æø ‡Æ™‡Æ∞‡Æ™‡Øç‡Æ™‡Øà ‡Æö‡ØÅ‡Æ§‡Øç‡Æ§‡ÆÆ‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡Æ§‡ØÅ, ‡ÆÖ‡Æµ‡Æ∞‡Øç‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡ØÅ ‡Æâ‡Æ£‡Æµ‡ØÅ ‡Æï‡Øä‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç."},
  {serial:"7.0", text:"‡ÆÖ‡Æ©‡Øà‡Æ§‡Øç‡Æ§‡ØÅ ‡ÆØ‡ØÇ‡Æ©‡Æø‡Æü‡Øç‡Æï‡Æ≥‡Æø‡Æ≤‡Øç ‡Æï‡Ææ‡Æ≤‡Øà‡ÆØ‡Æø‡Æ≤‡Øç ‡Æú‡Æ©‡Øç‡Æ©‡Æ≤‡Øç‡Æï‡Æ≥‡Øç ‡Æ§‡Æø‡Æ±‡Æ®‡Øç‡Æ§‡ØÅ ‡Æï‡Ææ‡Æ±‡Øç‡Æ±‡Øã‡Æü‡Øç‡Æü‡ÆÆ‡Øç ‡Æè‡Æ±‡Øç‡Æ™‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡Æµ‡ØÅ‡ÆÆ‡Øç."},
  {serial:"8.0", text:"‡ÆÖ‡Æü‡ØÅ‡Æï‡Øç‡Æï‡ØÅ ‡Æö‡ÆÆ‡Øà‡ÆØ‡Æ≤‡Æ±‡Øà ‡Æ™‡Øä‡Æ∞‡ØÅ‡Æü‡Øç‡Æï‡Æ≥‡Øç ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æ™‡ØÜ‡Æü‡Øç‡Æü‡Æø‡Æï‡Æ≥‡Øà ‡Æö‡Æ∞‡Æø‡Æ™‡Ææ‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç."},
  {serial:"9.0", text:"UPS ‡Æö‡Ææ‡Æ∞‡Øç‡Æú‡Øç ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æ§‡Æ£‡Øç‡Æ£‡ØÄ‡Æ∞‡Øç ‡Æ®‡Æø‡Æ≤‡Øà‡ÆØ‡Øà ‡Æö‡Æ∞‡Æø‡Æ™‡Ææ‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç."},
  {serial:"10.0", text:"‡Æú‡ØÜ‡Æ©‡Æ∞‡Øá‡Æü‡Øç‡Æü‡Æ∞‡Æø‡Æ≤‡Øç ‡Æé‡Æ™‡Øç‡Æ™‡Øã‡Æ§‡ØÅ‡ÆÆ‡Øç ‡Æ™‡Øã‡Æ§‡ØÅ‡ÆÆ‡Ææ‡Æ© ‡Æ™‡ØÜ‡Æü‡Øç‡Æ∞‡Øã‡Æ≤‡Øç ‡Æá‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡ØÅ‡ÆÆ‡Ææ‡Æ±‡ØÅ ‡Æµ‡Øà‡Æ§‡Øç‡Æ§‡Æø‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç."},
  {serial:"11.0", text:"‡ÆÆ‡Æû‡Øç‡Æö‡Æ≥‡Øç ‡ÆÆ‡ØÜ‡Æ§‡Øç‡Æ§‡Øà, ‡Æ§‡Æ≤‡Øà‡ÆØ‡Æ£‡Øà ‡ÆÆ‡ØÇ‡Æü‡ØÅ‡Æï‡Æ≥‡Øç, ‡Æ™‡Æû‡Øç‡Æö‡ØÅ ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æ§‡ØÅ‡Æ£‡Æø‡Æï‡Æ≥‡Øà ‡Æï‡Æ¥‡ØÅ‡Æµ‡Æµ‡ØÅ‡ÆÆ‡Øç."},
  {serial:"12.0", text:"‡Æè‡Æ§‡Øá‡Æ©‡ØÅ‡ÆÆ‡Øç ‡Æö‡Øá‡Æ§‡ÆÆ‡Æü‡Øà‡Æ®‡Øç‡Æ§ ‡Æ™‡Øä‡Æ∞‡ØÅ‡Æü‡Øç‡Æï‡Æ≥‡Øà‡Æö‡Øç ‡Æö‡Æ∞‡Æø ‡Æö‡ØÜ‡ÆØ‡Øç‡Æ§‡ØÅ ‡Æ™‡ØÅ‡Æï‡Ææ‡Æ∞‡Æ≥‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç."},
  {serial:"13.0", text:"‡Æï‡ØÅ‡Æ¥‡Æ™‡Øç‡Æ™‡ÆÆ‡Æø‡Æ≤‡Øç‡Æ≤‡Ææ‡ÆÆ‡Æ≤‡Øç ‡Æâ‡Æ£‡Æµ‡ØÅ ‡Æï‡Æ¥‡Æø‡Æµ‡ØÅ‡Æï‡Æ≥‡Øà ‡Æ®‡Ææ‡Æï‡Æ∞‡Ææ‡Æú‡Æ©‡Øç ‡Æ™‡Æï‡ØÅ‡Æ§‡Æø‡ÆØ‡Æø‡Æ≤‡ØÅ‡Æ≥‡Øç‡Æ≥ ‡Æï‡ÆÆ‡Øç‡Æ™‡Øã‡Æ∏‡Øç‡Æü‡Øç ‡Æö‡Æø‡Æ§‡Øç‡Æ§‡Æø‡Æ∞‡Æ§‡Øç‡Æ§‡Æø‡Æ≤‡Øç ‡Æá‡Æü‡Æµ‡ØÅ‡ÆÆ‡Øç."},
  {serial:"14.0", text:"‡Æµ‡ØÜ‡Æ≥‡Æø‡Æ™‡Øç‡Æ™‡ØÅ‡Æ± ‡Æ®‡Æ™‡Æ∞‡Øç‡Æï‡Æ≥‡Øà ‡ÆÖ‡Æ©‡ØÅ‡ÆÆ‡Æ§‡Æø‡Æï‡Øç‡Æï‡Ææ‡Æ§‡ØÄ‡Æ∞‡Øç‡Æï‡Æ≥‡Øç; ‡ÆØ‡Ææ‡Æ∞‡Ææ‡Æµ‡Æ§‡ØÅ ‡Æµ‡Æ®‡Øç‡Æ§‡Ææ‡Æ≤‡Øç ‡Æ§‡Æï‡Æµ‡Æ≤‡Øç ‡Æ§‡Æ∞‡Æµ‡ØÅ‡ÆÆ‡Øç."},
  {serial:"15.0", text:"‡Æï‡Æ¥‡Æø‡Æ™‡Øç‡Æ™‡Æ±‡Øà‡Æï‡Æ≥‡Øà ‡Æ§‡Æø‡Æ©‡Æö‡Æ∞‡Æø ‡Æö‡ØÅ‡Æ§‡Øç‡Æ§‡ÆÆ‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æµ‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æâ‡ÆÆ‡Æø‡Æ¥‡Øç‡Æµ‡ØÅ‡Æï‡Æ≥‡Øà ‡Æö‡Æ∞‡Æø‡Æ™‡Ææ‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç."},
  {serial:"16.0", text:"‡ÆÆ‡Ææ‡Æ≤‡Øç‡Æ©‡ÆÆ‡Øç ‡Æ™‡ØÜ‡Æü‡Øç‡Æü‡Æø‡Æï‡Æ≥‡Øà ‡Æï‡Ææ‡Æ≤‡Æø ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æµ‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æö‡ØÅ‡Æ±‡Øç‡Æ±‡ØÅ‡Æ™‡Øç‡Æ™‡ØÅ‡Æ±‡Æ§‡Øç‡Æ§‡Øà ‡Æö‡ØÅ‡Æ§‡Øç‡Æ§‡ÆÆ‡Ææ‡Æï ‡Æµ‡Øà‡Æ§‡Øç‡Æ§‡Æø‡Æ∞‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç."},
  {serial:"17.0", text:"‡Æï‡Æ≤‡Æô‡Øç‡Æï‡Ææ‡ÆÆ‡Æ≤‡Øç ‡Æµ‡Øà‡Æï‡Øç‡Æï, ‡Æ®‡Ææ‡Æï‡Æ∞‡Ææ‡Æú‡Æ©‡Øç ‡Æ™‡Æï‡ØÅ‡Æ§‡Æø‡ÆØ‡Øà ‡ÆÖ‡Æ∞‡ØÅ‡Æï‡Æø‡Æ≤‡Øá‡ÆØ‡Øá ‡Æâ‡Æü‡Øà‡Æï‡Æ≥‡Øç ‡Æâ‡Æ≤‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Æµ‡ØÅ‡ÆÆ‡Øç."},
  {serial:"18.0", text:"‡Æï‡Æ£‡Øç‡Æ£‡Ææ‡Æü‡Æø, ‡Æï‡Æø‡Æ≥‡Ææ‡Æ∏‡Øç, ‡Æú‡Æï‡Øç‡Æï‡ØÅ‡Æï‡Æ≥‡Øç, ‡Æï‡Øá‡Æü‡Øç‡Æü‡Æø‡Æ≤‡Øç ‡Æ™‡Øã‡Æ©‡Øç‡Æ±‡Æµ‡Æ±‡Øç‡Æ±‡Øà ‡Æö‡ØÅ‡Æ§‡Øç‡Æ§‡ÆÆ‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡Æ§‡ØÅ ‡Æµ‡Æø‡Æ∞‡ØÅ‡Æ®‡Øç‡Æ§‡Æø‡Æ©‡Æ∞‡Øç‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡ØÅ‡Æ§‡Øç ‡Æ§‡ÆØ‡Ææ‡Æ∞‡Øç ‡Æµ‡Øà‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç."}
];

let WEEKLY_SOP = [
  {serial:"19.0", text:"‡Æµ‡ØÄ‡Æü‡Øç‡Æü‡ØÅ ‡Æ™‡Æ∞‡Æ™‡Øç‡Æ™‡Øà ‡Æµ‡Ææ‡Æ∞‡Æ§‡Øç‡Æ§‡Æø‡Æ≤‡Øç ‡ÆÆ‡ØÇ‡Æ©‡Øç‡Æ±‡ØÅ ‡ÆÆ‡ØÅ‡Æ±‡Øà ‡ÆÆ‡Øá‡Æ≤‡Æø‡Æ∞‡ØÅ‡Æ®‡Øç‡Æ§‡ØÅ ‡Æï‡ØÄ‡Æ¥‡Øç ‡Æµ‡Æ∞‡Øà ‡Æö‡ØÅ‡Æ§‡Øç‡Æ§‡ÆÆ‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æµ‡ØÅ‡ÆÆ‡Øç."},
  {serial:"20.0", text:"‡ÆÆ‡Æ∞‡ÆÆ‡Øç, ‡Æö‡ØÜ‡Æü‡Æø‡Æï‡Æ≥‡Øç ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æï‡Ææ‡ÆØ‡Øç‡Æï‡Æ±‡Æø‡Æï‡Æ≥‡Øà ‡Æ™‡Æ∞‡Ææ‡ÆÆ‡Æ∞‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç ‚Äì ‡Æï‡ØÄ‡Æ∞‡Øà‡Æï‡Æ≥‡Øç ‡ÆÖ‡Æï‡Æ±‡Øç‡Æ±‡Æµ‡ØÅ‡ÆÆ‡Øç, ‡Æï‡ÆÆ‡Øç‡Æ™‡Øã‡Æ∏‡Øç‡Æü‡Øç ‡Æ™‡ÆØ‡Æ©‡Øç‡Æ™‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡Æµ‡ØÅ‡ÆÆ‡Øç."},
  {serial:"21.0", text:"‡ÆÆ‡Øá‡Æ≤‡Øç ‡Æï‡ØÇ‡Æ∞‡Øà ‡Æµ‡Ææ‡Æ∞‡Æ§‡Øç‡Æ§‡Æø‡Æ≤‡Øç ‡ÆÆ‡ØÇ‡Æ©‡Øç‡Æ±‡ØÅ ‡ÆÆ‡ØÅ‡Æ±‡Øà ‡Æö‡ØÅ‡Æ§‡Øç‡Æ§‡ÆÆ‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æµ‡ØÅ‡ÆÆ‡Øç; ‡Æï‡Øã‡Æ£‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ§‡ØÇ‡Æö‡Æø ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æµ‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æ§‡Æ∞‡Øà ‡Æ§‡ØÅ‡Æü‡Øà‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç."},
  {serial:"22.0", text:"‡ÆÖ‡Æ©‡Øà‡Æ§‡Øç‡Æ§‡ØÅ ‡Æï‡Æ§‡Æµ‡ØÅ ‡ÆÆ‡Øá‡Æü‡Øç‡Æ∞‡Ææ‡Æ∏‡Øç ‡Æï‡Æ¥‡ØÅ‡Æµ‡Æµ‡ØÅ‡ÆÆ‡Øç."},
  {serial:"23.0", text:"‡Æï‡Æ§‡Æµ‡ØÅ‡Æï‡Æ≥‡Øç, ‡Æú‡Æ©‡Øç‡Æ©‡Æ≤‡Øç‡Æï‡Æ≥‡Øç, ‡Æï‡Æ£‡Øç‡Æ£‡Ææ‡Æü‡Æø, ‡Æµ‡Æø‡Æö‡Æø‡Æ±‡Æø‡Æï‡Æ≥‡Øç, ‡ÆÆ‡Øá‡Æö‡Øà‡Æï‡Æ≥‡Øç ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡ÆØ‡ØÇ‡Æ©‡Æø‡Æü‡Øç ‡Æâ‡Æ≥‡Øç‡Æ≥‡ÆÆ‡Øà‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Æ≥‡Øà ‡ÆÜ‡Æ¥‡ÆÆ‡Ææ‡Æï ‡Æö‡ØÅ‡Æ§‡Øç‡Æ§‡ÆÆ‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æµ‡ØÅ‡ÆÆ‡Øç."},
  {serial:"25.0", text:"‡ÆØ‡ØÇ‡Æ©‡Æø‡Æü‡Øç‡Æï‡Æ≥‡Øà ‡Æ™‡Æ∞‡Ææ‡ÆÆ‡Æ∞‡Æø‡Æ™‡Øç‡Æ™‡ØÅ ‡Æ§‡Øá‡Æµ‡Øà ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡Æ™‡Æ¥‡ØÅ‡Æ§‡ØÅ ‡Æ™‡Ææ‡Æ∞‡Øç‡Æµ‡Øà ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æµ‡ØÅ‡ÆÆ‡Øç."},
  {serial:"26.0", text:"‡Æï‡Øá‡ÆÆ‡Øç‡Æ™‡Øç‡ÆÉ‡Æ™‡ÆØ‡Æ∞‡Øç ‡Æï‡Øç‡Æï‡Ææ‡Æ© ‡Æµ‡Æ±‡Æ£‡Øç‡Æü ‡ÆÆ‡Æ∞‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ§‡ÆØ‡Ææ‡Æ∞‡Ææ‡Æï ‡Æá‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡ØÅ‡ÆÆ‡Ææ‡Æ±‡ØÅ ‡Æµ‡Øà‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç."},
  {serial:"27.0", text:"‡Æ™‡Ææ‡Æ∞‡Øç‡Æ™‡Æø‡Æï‡Æø‡ÆØ‡ØÇ ‡Æï‡Øç‡Æï‡Ææ‡Æ© ‡Æö‡Ææ‡Æ∞‡Øç‡Æï‡Øã‡Æ≤‡Øç ‡Æ™‡Æ∞‡Ææ‡ÆÆ‡Æ∞‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç."},
  {serial:"28.0", text:"‡Æï‡Æ£‡Øç‡Æ£‡Ææ‡Æü‡Æø, ‡Æú‡Æï‡Øç‡Æï‡ØÅ‡Æï‡Æ≥‡Øç, ‡Æï‡Æø‡Æ≥‡Ææ‡Æ∏‡Øç ‡ÆÖ‡Æ©‡Øà‡Æ§‡Øç‡Æ§‡Øà‡ÆØ‡ØÅ‡ÆÆ‡Øç ‡Æâ‡Æ≤‡Æ∞‡Øç‡Æ®‡Øç‡Æ§ ‡Æö‡ØÅ‡Æ§‡Øç‡Æ§‡Æ™‡Øç ‡Æ™‡Øç‡Æ∞‡Æ∑‡Øç ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æö‡Øã‡Æ™‡Øç‡Æ™‡Ææ‡Æ≤‡Øç ‡Æö‡ØÅ‡Æ§‡Øç‡Æ§‡ÆÆ‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æµ‡ØÅ‡ÆÆ‡Øç."},
  {serial:"29.0", text:"‡ÆÖ‡Æ©‡Øà‡Æ§‡Øç‡Æ§‡ØÅ ‡Æö‡ØÅ‡Æ§‡Øç‡Æ§‡Æ™‡Øç‡Æ™‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡ÆÆ‡Øç ‡Æ§‡ØÅ‡Æ£‡Æø‡Æï‡Æ≥‡Øà ‡ÆÆ‡ØÜ‡Æ∑‡Æø‡Æ©‡Æø‡Æ≤‡Øç ‡Æï‡Æ¥‡ØÅ‡Æµ‡Æø, ‡Æ™‡Æü‡Øç‡Æü‡Æø‡ÆØ‡Æ≤‡Øà ‡Æ™‡Æ∞‡Ææ‡ÆÆ‡Æ∞‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç."},
  {serial:"30.0", text:"‡ÆÖ‡Æ©‡Øà‡Æ§‡Øç‡Æ§‡ØÅ ‡ÆØ‡ØÇ‡Æ©‡Æø‡Æü‡Øç‡Æï‡Æ≥‡Æø‡Æ©‡Øç ‡Æ™‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Øà ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æö‡ØÅ‡Æµ‡Æ∞‡Æø‡Æ©‡Øç ‡Æ®‡Æø‡Æ≤‡Øà‡ÆØ‡Øà ‡Æï‡Ææ‡Æü‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç ‡Æ§‡ØÜ‡Æ≥‡Æø‡Æµ‡Ææ‡Æ© ‡Æµ‡ØÄ‡Æü‡Æø‡ÆØ‡Øã‡Æï‡Øç‡Æï‡Æ≥‡Øà ‡ÆÖ‡Æ©‡ØÅ‡Æ™‡Øç‡Æ™‡Æµ‡ØÅ‡ÆÆ‡Øç."},
  {serial:"31.0", text:"‡Æâ‡Æü‡Øà ‡Æâ‡Æ≤‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡ØÅ‡ÆÆ‡Øç ‡Æ™‡Øã‡Æ§‡ØÅ ‡Æ®‡Øá‡Æ∞‡Æü‡Æø‡ÆØ‡Ææ‡Æï ‡Æö‡ØÇ‡Æ∞‡Æø‡ÆØ ‡Æí‡Æ≥‡Æø‡ÆØ‡Æø‡Æ≤‡Øç ‡Æµ‡Øà‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç; ‡ÆÆ‡ØÜ‡Æ∑‡Æø‡Æ©‡Æø‡Æ≤‡Øç ‡Æ§‡Æ£‡Øç‡Æ£‡ØÄ‡Æ∞‡Øç ‡Æá‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡ØÅ‡ÆÆ‡Øç ‡Æ™‡Øã‡Æ§‡ØÅ ‡Æµ‡Æø‡Æü‡Ææ‡Æ§‡ØÄ‡Æ∞‡Øç‡Æï‡Æ≥‡Øç."},
  {serial:"32.0", text:"‡ÆÆ‡ØÜ‡Æ§‡Øç‡Æ§‡Æø‡Æ∞‡Æ∏‡Øç ‡ÆÆ‡ØÇ‡Æü‡ØÅ‡Æï‡Æ≥‡Øà ‡ÆÆ‡ØÅ‡Æ¥‡ØÅ‡ÆÆ‡Øà‡ÆØ‡Ææ‡Æï ‡Æâ‡Æ≤‡Æ∞‡Øç‡Æ®‡Øç‡Æ§ ‡Æ™‡Æø‡Æ±‡Æï‡ØÅ ‡Æö‡Øá‡ÆÆ‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç."},
  {serial:"33.0", text:"‡Æâ‡Æ≥‡Øç‡Æ≥‡Æü‡Æï‡Øç‡Æï ‡ÆÆ‡Æ§‡Æô‡Øç‡Æï‡Æ≥‡Øà ‡Æï‡Øà ‡Æï‡Æ¥‡ØÅ‡Æµ‡Æµ‡ØÅ‡ÆÆ‡Øç."},
  {serial:"34.0", text:"‡Æâ‡Æ≥‡Øç‡Æ≥‡ÆÆ‡Øà‡Æ®‡Øç‡Æ§ ‡Æ§‡Ææ‡Æµ‡Æ∞‡Æô‡Øç‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡ØÅ ‡Æµ‡Ææ‡Æ∞‡Æ§‡Øç‡Æ§‡Æø‡Æ±‡Øç‡Æï‡ØÅ ‡Æá‡Æ∞‡Æ£‡Øç‡Æü‡ØÅ ‡ÆÆ‡ØÅ‡Æ±‡Øà ‡Æ§‡Æ£‡Øç‡Æ£‡ØÄ‡Æ∞‡Øç ‡Æµ‡Æ¥‡Æô‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç."},
  {serial:"35.0", text:"‡ÆÖ‡Æ©‡Øà‡Æ§‡Øç‡Æ§‡ØÅ ‡ÆÖ‡Æ≤‡Æô‡Øç‡Æï‡Ææ‡Æ∞ ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡ØÜ‡Æ¥‡ØÅ‡Æï‡ØÅ‡Æµ‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Æø ‡Æü‡Æø‡Æ©‡Øç‡Æ©‡Æ∞‡Øç ‡Æ™‡Øä‡Æ∞‡ØÅ‡Æü‡Øç‡Æï‡Æ≥‡Øà ‡Æö‡Æ∞‡Æø‡Æ™‡Ææ‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç."},
  {serial:"36.0", text:"‡Æè‡Æ§‡Øá‡Æ©‡ØÅ‡ÆÆ‡Øç ‡Æ™‡Æ¥‡ØÅ‡Æ§‡ØÅ ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡Æ™‡Æ∞‡Ææ‡ÆÆ‡Æ∞‡Æø‡Æ™‡Øç‡Æ™‡ØÅ ‡Æ§‡Øá‡Æµ‡Øà ‡Æá‡Æ∞‡ØÅ‡Æ™‡Øç‡Æ™‡Æø‡Æ©‡Øç ‡Æâ‡Æü‡Æ©‡Æü‡Æø‡ÆØ‡Ææ‡Æï ‡Æ™‡ØÅ‡Æï‡Ææ‡Æ∞‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æµ‡ØÅ‡ÆÆ‡Øç."},
  {serial:"37.0", text:"‡Æï‡Øã‡Æ¥‡Æø (‡Æ≤‡Æü‡Øç‡Æö‡ØÅ‡ÆÆ‡Æø)‡Æï‡Øç‡Æï‡ØÅ ‡Æµ‡Ææ‡Æ∞‡Æ§‡Øç‡Æ§‡Æø‡Æ±‡Øç‡Æï‡ØÅ ‡Æá‡Æ∞‡Æ£‡Øç‡Æü‡ØÅ ‡ÆÆ‡ØÅ‡Æ±‡Øà ‡Æ®‡ØÄ‡Æ∞‡Ææ‡Æü ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æµ‡ØÅ‡ÆÆ‡Øç."},
  {serial:"38.0", text:"‡Æö‡ÆÆ‡Øà‡ÆØ‡Æ≤‡Æ±‡Øà‡ÆØ‡Øà ‡ÆÜ‡Æ¥‡ÆÆ‡Ææ‡Æï ‡Æö‡ØÅ‡Æ§‡Øç‡Æ§‡ÆÆ‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æµ‡ØÅ‡ÆÆ‡Øç, ‡Æí‡Æµ‡Øç‡Æµ‡Øä‡Æ∞‡ØÅ 10 ‡Æ®‡Ææ‡Æü‡Øç‡Æï‡Æ≥‡ØÅ‡ÆÆ‡Øç."},
  {serial:"39.0", text:"‡Æ™‡Æø‡Æ∞‡Æ§‡Æø ‡Æ™‡Ææ‡Æï‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æï‡Æ∞‡ØÅ‡Æµ‡Æø‡Æï‡Æ≥‡Øç ‡Æ™‡Æü‡Øç‡Æü‡Æø‡ÆØ‡Æ≤‡Øà ‡Æ™‡Æ∞‡Ææ‡ÆÆ‡Æ∞‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç; ‡Æï‡Æü‡Æ©‡Æø‡Æ≤‡Øç ‡Æµ‡Æø‡Æü‡Ææ‡Æ§‡ØÄ‡Æ∞‡Øç‡Æï‡Æ≥‡Øç."}
];

let MONTHLY_SOP = [
  {serial:"40.0", text:"‡Æö‡Øã‡Æ™‡Ææ ‡Æï‡ØÅ‡Æ∑‡Æ©‡Øç ‡ÆÆ‡ØÇ‡Æü‡Æø‡Æï‡Æ≥‡Øà ‡ÆÆ‡Ææ‡Æ§‡Æ§‡Øç‡Æ§‡Æø‡Æ≤‡Øç ‡Æí‡Æ∞‡ØÅ‡ÆÆ‡ØÅ‡Æ±‡Øà ‡Æï‡Æ¥‡ØÅ‡Æµ‡Æø ‡Æâ‡Æ≤‡Æ∞‡Øç‡Æ®‡Øç‡Æ§ ‡Æ™‡Æø‡Æ±‡Æï‡ØÅ ‡ÆÆ‡Ææ‡Æ±‡Øç‡Æ±‡Æµ‡ØÅ‡ÆÆ‡Øç."},
  {serial:"41.0", text:"‡ÆÖ‡Æ©‡Øà‡Æ§‡Øç‡Æ§‡ØÅ ‡Æ™‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Øà ‡Æ§‡ØÅ‡Æ£‡Æø‡Æï‡Æ≥‡Øç, ‡Æö‡ÆÆ‡Øà‡ÆØ‡Æ≤‡Øç ‡Æ™‡Ææ‡Æ§‡Øç‡Æ§‡Æø‡Æ∞‡Æô‡Øç‡Æï‡Æ≥‡Øç, ‡Æ§‡Æ≤‡Øà‡ÆØ‡Æ£‡Øà, ‡Æ™‡Øã‡Æ∞‡Øç‡Æµ‡Øà‡Æï‡Æ≥‡Øç, ‡Æµ‡Æø‡Æ≥‡Øà‡ÆØ‡Ææ‡Æü‡Øç‡Æü‡ØÅ‡Æ™‡Øç ‡Æ™‡Øä‡Æ∞‡ØÅ‡Æü‡Øç‡Æï‡Æ≥‡Øà ‡Æé‡Æ£‡Øç‡Æ£‡Æµ‡ØÅ‡ÆÆ‡Øç."},
  {serial:"42.0", text:"‡ÆÖ‡Æ©‡Øà‡Æ§‡Øç‡Æ§‡ØÅ ‡Æ™‡Øä‡Æ∞‡ØÅ‡Æü‡Øç‡Æï‡Æ≥‡Øà ‡Æö‡Æ∞‡Æø‡Æ™‡Ææ‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡ØÅ ‡Æ™‡Æ§‡Æø‡Æµ‡ØÅ ‡Æ™‡ØÅ‡Æ§‡Øç‡Æ§‡Æï‡Æ§‡Øç‡Æ§‡Æø‡Æ≤‡Øç ‡Æá‡Æü‡Æµ‡ØÅ‡ÆÆ‡Øç."},
  {serial:"43.0", text:"‡Æö‡Øá‡Æ§‡ÆÆ‡Æü‡Øà‡Æ®‡Øç‡Æ§ ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡ÆÆ‡Ææ‡Æö‡ØÅ‡Æ™‡Æü‡Øç‡Æü ‡ÆÆ‡ØÜ‡Æ§‡Øç‡Æ§‡Æø‡Æ∞‡Æ∏‡Øç ‡ÆÆ‡ØÇ‡Æü‡Æø‡Æï‡Æ≥‡Øà ‡Æ™‡ØÅ‡Æï‡Øà‡Æ™‡Øç‡Æ™‡Æü‡ÆÆ‡Øç ‡Æé‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ ‡ÆÖ‡Æï‡Æ±‡Øç‡Æ±‡Æµ‡ØÅ‡ÆÆ‡Øç."},
  {serial:"44.0", text:"‡Æü‡Æø‡Æµ‡Æø ‡Æ™‡Ææ‡Æï‡Øç‡Æï‡Øá‡Æú‡Øà ‡Æ∞‡ØÄ‡Æö‡Ææ‡Æ∞‡Øç‡Æú‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æµ‡ØÅ‡ÆÆ‡Øç."}
];

const originalSOP = {
  daily: JSON.parse(JSON.stringify(DAILY_SOP)),
  weekly: JSON.parse(JSON.stringify(WEEKLY_SOP)),
  monthly: JSON.parse(JSON.stringify(MONTHLY_SOP))
};

// English translation dataset (kept same)
const ENGLISH_SOP = {
  daily: [
    {serial:"1.0",text:"Perform daily pooja without fail."},
    {serial:"2.0",text:"Fill the water tank before evening."},
    {serial:"3.0",text:"Run the pond motor for 2 hours daily and check water level."},
    {serial:"4.0",text:"Send Lakshmi (cow) to graze and keep her area clean."},
    {serial:"5.0",text:"Bring Lakshmi back in the evening and provide enough water."},
    {serial:"6.0",text:"Clean the hen area and feed them."},
    {serial:"7.0",text:"Open windows in all units in the morning for ventilation."},
    {serial:"8.0",text:"Check kitchen items and boxes."},
    {serial:"9.0",text:"Check UPS charge and water level."},
    {serial:"10.0",text:"Keep sufficient petrol in generator always."},
    {serial:"11.0",text:"Wash bed covers, pillow covers, blankets, and towels."},
    {serial:"12.0",text:"Report and fix any damaged mattress covers or items."},
    {serial:"13.0",text:"Dispose food waste (not plastic) in compost pit near Nagarajan's area."},
    {serial:"14.0",text:"Do not allow outsiders into premises; report if anyone comes."},
    {serial:"15.0",text:"Clean bathrooms daily and check for leaks."},
    {serial:"16.0",text:"Empty garbage bins and keep surroundings clean."},
    {serial:"17.0",text:"Dry clothes near Nagarajan‚Äôs area, not visible from property."},
    {serial:"18.0",text:"Clean bottles, glasses, jugs, kettles and keep ready for guests."}
  ],
  weekly: [
    {serial:"19.0",text:"Clean premises from top to bottom thrice a week."},
    {serial:"20.0",text:"Maintain trees, plants, and vegetables ‚Äì remove weeds, apply compost."},
    {serial:"21.0",text:"Clean top shed thrice weekly; dust furniture and mop floor."},
    {serial:"22.0",text:"Wash all door mats."},
    {serial:"23.0",text:"Deep clean doors, windows, glass, fans, tables, and unit interiors."},
    {serial:"25.0",text:"Inspect units for repairs or maintenance needs."},
    {serial:"26.0",text:"Keep dry firewood ready for campfire."},
    {serial:"27.0",text:"Maintain charcoal for barbecue."},
    {serial:"28.0",text:"Clean bottles, jugs, glasses well with brush and soap."},
    {serial:"29.0",text:"Wash all cleaning cloths in washing machine and maintain stock list."},
    {serial:"30.0",text:"Send clear videos of each unit showing condition of beds and walls."},
    {serial:"31.0",text:"Wash and dry clothes in sunlight; do not leave wet in machine overnight."},
    {serial:"32.0",text:"Store mattress covers only after fully dried."},
    {serial:"33.0",text:"Hand wash all indoor mats."},
    {serial:"34.0",text:"Water indoor plants twice a week."},
    {serial:"35.0",text:"Check all decorative and candlelight dinner items."},
    {serial:"36.0",text:"Report any repair or maintenance requirements immediately."},
    {serial:"37.0",text:"Give cow (Lakshmi) water bath twice a week."},
    {serial:"38.0",text:"Deep clean kitchen once every 10 days."},
    {serial:"39.0",text:"Maintain list of spare parts and tools; do not lend them out."}
  ],
  monthly: [
    {serial:"40.0",text:"Wash sofa cushion covers monthly and replace after drying."},
    {serial:"41.0",text:"Count all bed sheets, kitchen dishes, pillows, blankets, games, etc."},
    {serial:"42.0",text:"Take stock of all items and record in register."},
    {serial:"43.0",text:"Remove damaged or stained mattress covers after photographing."},
    {serial:"44.0",text:"Recharge TV package."}
  ]
};

const loadBtn = document.getElementById("loadBtn");
const fromDate = document.getElementById("fromDate");
const toDate = document.getElementById("toDate");
const tableBody = document.querySelector("#recordsTable tbody");
const tabs = document.querySelectorAll(".tab");
let currentType = "daily";
let isTranslated = false;

// Load SOP data
loadBtn.addEventListener("click", async () => {
  tableBody.innerHTML = "<tr><td colspan='4'>Loading...</td></tr>";
  if (!fromDate.value || !toDate.value) {
    alert("Please select date range.");
    return;
  }
  const start = new Date(fromDate.value);
  const end = new Date(toDate.value);

  const [dailySnap, weeklySnap, monthlySnap] = await Promise.all([
    db.ref("daily_sop").get(),
    db.ref("weekly_sop").get(),
    db.ref("monthly_sop").get()
  ]);

  const allData = {
    daily_sop: dailySnap.val() || {},
    weekly_sop: weeklySnap.val() || {},
    monthly_sop: monthlySnap.val() || {}
  };

  const combinedRecords = [];
  for (const [type, data] of Object.entries(allData)) {
    Object.entries(data).forEach(([date, record]) => {
      const d = new Date(date);
      if (d >= start && d <= end) {
        combinedRecords.push({ date, type, checked_items: record.checked_items || [] });
      }
    });
  }

  renderTable(combinedRecords);
});

// Render table
function renderTable(records) {
  tableBody.innerHTML = "";
  const master = currentType === "daily" ? DAILY_SOP :
                  currentType === "weekly" ? WEEKLY_SOP : MONTHLY_SOP;

  records.forEach(record => {
    if (record.type.replace("_sop","") === currentType) {
      const checkedSerials = (record.checked_items || []).map(i => i.serial);
      const unticked = master.filter(item => !checkedSerials.includes(item.serial));
      unticked.forEach(item => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${record.date}</td>
          <td>${item.serial || ""}</td>
          <td>${item.text}</td>
          <td>‚ùå Pending</td>
        `;
        tableBody.appendChild(tr);
      });
    }
  });

  if (!tableBody.innerHTML.trim()) {
    tableBody.innerHTML = "<tr><td colspan='4'>No unticked records found.</td></tr>";
  }
}

// Tab switching
tabs.forEach(tab => {
  tab.addEventListener("click", () => {
    if (tab.id === "translateBtn") return;
    tabs.forEach(t => t.classList.remove("active"));
    tab.classList.add("active");
    currentType = tab.dataset.type;
    loadBtn.click();
  });
});

// Translate toggle
document.getElementById("translateBtn").addEventListener("click", () => {
  if (!isTranslated) {
    DAILY_SOP = ENGLISH_SOP.daily;
    WEEKLY_SOP = ENGLISH_SOP.weekly;
    MONTHLY_SOP = ENGLISH_SOP.monthly;
    document.getElementById("translateBtn").textContent = "üîô Back to Tamil";
    document.getElementById("exportExcelBtn").style.display = "inline-block";
    isTranslated = true;
  } else {
    DAILY_SOP = originalSOP.daily;
    WEEKLY_SOP = originalSOP.weekly;
    MONTHLY_SOP = originalSOP.monthly;
    document.getElementById("translateBtn").textContent = "üåê Translate";
    document.getElementById("exportExcelBtn").style.display = "none";
    isTranslated = false;
  }
  loadBtn.click();
});

// Export CSV
document.getElementById("exportBtn").addEventListener("click", () => {
  const rows = [["Date", "Serial", "Task", "Status"]];
  document.querySelectorAll("#recordsTable tbody tr").forEach(tr => {
    const cols = Array.from(tr.children).map(td => td.textContent.trim());
    rows.push(cols);
  });
  let csv = rows.map(r => r.join(",")).join("\n");
  const blob = new Blob([csv], { type: "text/csv" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "Unticked_SOP_Report.csv";
  a.click();
});

// Export Excel
document.getElementById("exportExcelBtn").addEventListener("click", () => {
  const rows = [["Date","Serial","Task","Status"]];
  document.querySelectorAll("#recordsTable tbody tr").forEach(tr=>{
    rows.push(Array.from(tr.children).map(td=>td.textContent.trim()));
  });
  let csv = rows.map(r=>r.join("\t")).join("\n");
  const blob = new Blob([csv],{type:"application/vnd.ms-excel"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="Unticked_SOP_Report.xls";
  a.click();
});
</script>
</body>
</html>
